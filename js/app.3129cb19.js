(function(){"use strict";var o={9895:function(o,e,n){var t=n(5130),d=n(6768);const c={class:"canvas"};function i(o,e,n,t,i,l){const r=(0,d.g2)("BlockComponent"),s=(0,d.g2)("ConnectionComponent");return(0,d.uX)(),(0,d.CE)("div",null,[(0,d.Lk)("button",{onClick:e[0]||(e[0]=(...e)=>o.addBlock&&o.addBlock(...e))},"Добавить блок"),(0,d.Lk)("button",{onClick:e[1]||(e[1]=(...e)=>o.removeBlock&&o.removeBlock(...e))},"Удалить блок"),(0,d.Lk)("div",c,[(0,d.bF)(r),(0,d.bF)(s)])])}var l=n(782),r=n(4232);const s=["onMousedown"],u=["onClick"];function a(o,e,n,c,i,l){return(0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(o.blocks,(e=>((0,d.uX)(),(0,d.CE)("div",{class:"container",key:e.id,style:(0,r.Tr)({left:e.x+"px",top:e.y+"px"})},[(0,d.Lk)("div",{class:"block",onMousedown:n=>o.startDrag(e)},null,40,s),((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(e.nodes,((n,c)=>((0,d.uX)(),(0,d.CE)("div",{key:c,class:"node",style:(0,r.Tr)({left:n.x+"px",top:n.y+"px"}),onClick:(0,t.D$)((t=>o.handleNodeClick(e.id,n.id)),["stop"])},null,12,u)))),128)),(0,d.eW)(" "+(0,r.v_)(e.id),1)],4)))),128)}var f=(0,d.pM)({setup(){const o=(0,l.Pj)(),e=(0,d.EW)((()=>o.state.blocks||[])),n=e=>{const n=n=>{const t=n.clientX,d=n.clientY;o.dispatch("moveBlock",{id:e.id,x:t,y:d})},t=()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",t)},t=e=>{o.dispatch("handleNodeClick",e.id)},c=(e,n)=>{o.dispatch("handleNodeClick",{blockId:e,nodeId:n})};return{blocks:e,startDrag:n,handleBlockClick:t,handleNodeClick:c}}}),k=n(1241);const m=(0,k.A)(f,[["render",a],["__scopeId","data-v-49a20dad"]]);var v=m;const b={class:"connections"},p=["x1","y1","x2","y2"];function y(o,e,n,t,c,i){return(0,d.uX)(),(0,d.CE)("svg",b,[((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(o.connections,((o,e)=>((0,d.uX)(),(0,d.CE)("line",{key:e,x1:o.from.x,y1:o.from.y,x2:o.to.x,y2:o.to.y,stroke:"black","stroke-width":"2"},null,8,p)))),128))])}var x=(0,d.pM)({setup(){const o=(0,l.Pj)(),e=(0,d.EW)((()=>o.state.connections||[]));return{connections:e}}});const I=(0,k.A)(x,[["render",y],["__scopeId","data-v-fa71a356"]]);var C=I,h=(0,d.pM)({components:{BlockComponent:v,ConnectionComponent:C},setup(){const o=(0,l.Pj)(),e=()=>{const e={id:`block${o.state.blocks.length+1}`,x:50,y:50};o.commit("addBlock",e)},n=()=>{const e=prompt("Введите ID блока для удаления:");e&&o.commit("removeBlock",e)};return{addBlock:e,removeBlock:n}}});const B=(0,k.A)(h,[["render",i],["__scopeId","data-v-47e71d77"]]);var N=B,E=(n(4114),n(8992),n(4520),n(2577),n(3949),n(7550),(0,l.y$)({state:{blocks:[{id:"block1",x:100,y:100,nodes:[{id:"node1",x:0,y:0},{id:"node2",x:70,y:0},{id:"node3",x:0,y:70},{id:"node4",x:70,y:70}]},{id:"block2",x:250,y:100,nodes:[{id:"node1",x:0,y:0},{id:"node2",x:70,y:0},{id:"node3",x:0,y:70},{id:"node4",x:70,y:70}]}],connections:[],selectedNode:null},mutations:{addBlock(o,e){o.blocks.push({...e,nodes:[{id:"node1",x:0,y:0},{id:"node2",x:70,y:0},{id:"node3",x:0,y:70},{id:"node4",x:70,y:70}]})},removeBlock(o,e){o.blocks=o.blocks.filter((o=>o.id!==e)),o.connections=o.connections.filter((o=>o.from.blockId!==e&&o.to.blockId!==e))},updateBlockPosition(o,{id:e,x:n,y:t}){const d=o.blocks.find((o=>o.id===e));d&&(d.x=n,d.y=t,o.connections.forEach((o=>{if(o.from.blockId===e){const e=d.nodes.find((e=>e.id===o.from.nodeId));e&&(o.from.x=n+e.x,o.from.y=t+e.y)}if(o.to.blockId===e){const e=d.nodes.find((e=>e.id===o.to.nodeId));e&&(o.to.x=n+e.x,o.to.y=t+e.y)}})))},setSelectedNode(o,{blockId:e,nodeId:n}){const t=o.blocks.find((o=>o.id===e));if(t){const d=t.nodes.find((o=>o.id===n));d&&(o.selectedNode={blockId:e,nodeId:n,x:t.x+d.x,y:t.y+d.y})}},clearSelectedNode(o){o.selectedNode=null},addConnection(o,e){o.connections.push(e)},removeConnection(o,e){o.connections=o.connections.filter((o=>!(o.from.blockId===e.from.blockId&&o.from.nodeId===e.from.nodeId&&o.to.blockId===e.to.blockId&&o.to.nodeId===e.to.nodeId)))}},actions:{addBlock({commit:o},e){o("addBlock",e)},removeBlock({commit:o},e){o("removeBlock",e)},handleNodeClick({state:o,commit:e},{blockId:n,nodeId:t}){const d=o.blocks.find((o=>o.id===n)),c=d?.nodes.find((o=>o.id===t));if(d&&c)if(o.selectedNode){const i=o.selectedNode.blockId,l=o.selectedNode.nodeId;if(i===n)return console.log("Связи внутри одного блока запрещены"),void e("clearSelectedNode");const r=o.connections.find((o=>o.from.blockId===i&&o.to.blockId===n&&o.from.nodeId===l&&o.to.nodeId===t||o.from.blockId===n&&o.to.blockId===i&&o.from.nodeId===t&&o.to.nodeId===l));if(r)console.log("Удаляем существующую связь"),e("removeConnection",r);else{const l=o.connections.some((o=>o.from.blockId===i&&o.to.blockId===n||o.from.blockId===n&&o.to.blockId===i));if(l)return void e("clearSelectedNode");const r={from:o.selectedNode,to:{blockId:n,nodeId:t,x:d.x+c.x,y:d.y+c.y}};e("addConnection",r)}e("clearSelectedNode")}else e("setSelectedNode",{blockId:n,nodeId:t})},moveBlock({commit:o},{id:e,x:n,y:t}){o("updateBlockPosition",{id:e,x:n,y:t})}}}));const g=(0,t.Ef)(N);g.use(E),g.mount("#app")}},e={};function n(t){var d=e[t];if(void 0!==d)return d.exports;var c=e[t]={exports:{}};return o[t].call(c.exports,c,c.exports,n),c.exports}n.m=o,function(){var o=[];n.O=function(e,t,d,c){if(!t){var i=1/0;for(u=0;u<o.length;u++){t=o[u][0],d=o[u][1],c=o[u][2];for(var l=!0,r=0;r<t.length;r++)(!1&c||i>=c)&&Object.keys(n.O).every((function(o){return n.O[o](t[r])}))?t.splice(r--,1):(l=!1,c<i&&(i=c));if(l){o.splice(u--,1);var s=d();void 0!==s&&(e=s)}}return e}c=c||0;for(var u=o.length;u>0&&o[u-1][2]>c;u--)o[u]=o[u-1];o[u]=[t,d,c]}}(),function(){n.n=function(o){var e=o&&o.__esModule?function(){return o["default"]}:function(){return o};return n.d(e,{a:e}),e}}(),function(){n.d=function(o,e){for(var t in e)n.o(e,t)&&!n.o(o,t)&&Object.defineProperty(o,t,{enumerable:!0,get:e[t]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(o){if("object"===typeof window)return window}}()}(),function(){n.o=function(o,e){return Object.prototype.hasOwnProperty.call(o,e)}}(),function(){var o={524:0};n.O.j=function(e){return 0===o[e]};var e=function(e,t){var d,c,i=t[0],l=t[1],r=t[2],s=0;if(i.some((function(e){return 0!==o[e]}))){for(d in l)n.o(l,d)&&(n.m[d]=l[d]);if(r)var u=r(n)}for(e&&e(t);s<i.length;s++)c=i[s],n.o(o,c)&&o[c]&&o[c][0](),o[c]=0;return n.O(u)},t=self["webpackChunkno_code"]=self["webpackChunkno_code"]||[];t.forEach(e.bind(null,0)),t.push=e.bind(null,t.push.bind(t))}();var t=n.O(void 0,[504],(function(){return n(9895)}));t=n.O(t)})();
//# sourceMappingURL=app.3129cb19.js.map